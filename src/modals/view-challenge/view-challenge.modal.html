<ion-header>
  <ion-toolbar>
    <ion-title>
      {{challenge.name}} Progress
    </ion-title>
    <ion-buttons start>
      <button ion-button (click)="dismiss()">
        <span ion-text color="primary" showWhen="ios">Cancel</span>
        <ion-icon name="md-close" showWhen="android,windows"></ion-icon>
      </button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="outer-content">

  <ion-card>
    <img src="img/challenges/{{challenge.image_url}}"/>
    <ion-item>
      <ion-icon item-left name="trophy"></ion-icon>
      <h2>{{challenge.name}}</h2>
      <p style="white-space: normal">{{challenge.description}}</p>
    </ion-item>
    <ion-item>
      <ion-icon item-left name="flash"></ion-icon>
      <h2>{{challenge.xp}} XP</h2>
    </ion-item>
    <ion-item>
      <ion-icon item-left name="walk"></ion-icon>
      <span item-left>{{challenge.completion.required}} {{challenge.type}}</span>
      <button ion-button icon-left clear item-right
              *ngIf="!challenge.active" color="danger">
        <ion-icon name="clock"></ion-icon>
        <span>Pending</span>
      </button>
    </ion-item>
  </ion-card>

  <ion-list>
    <ion-list-header>
      Participants
    </ion-list-header>

    <ion-spinner name="bubbles" *ngIf="loading"></ion-spinner>
    <ion-card *ngIf="!loading" >
      <ion-item *ngIf="!loading">
        <ion-avatar item-left>
          <img src="https://ionicframework.com/dist/preview-app/www/assets/img/avatar-finn.png">
        </ion-avatar>
        <h2>{{leader.fitness_stats.name}} <ion-icon color="golden" name="ribbon"></ion-icon> <i *ngIf="leader.complete_date"><ion-icon color="primary" name="checkmark-circle"></ion-icon></i> </h2>
        <p style="white-space: normal"></p>
      </ion-item>
      <ion-item *ngIf="!loading">
        <ion-icon item-left name="trophy"></ion-icon>
        <h2>{{leader.percentage}}%</h2>
        <progress value="{{leader.progress}}" max="{{challenge.completion.required}}"></progress>
      </ion-item>
      <ion-item *ngIf="leader.complete">
        <ion-icon item-left name="stopwatch"></ion-icon>
        <h2>Completed : {{leader.complete_date | HumanizeDate}} ago</h2>
      </ion-item>
      <ion-item *ngIf="!leader.complete" >
        <ion-icon item-left name="clock"></ion-icon>
        <h2 *ngIf="leader.last_update" >Last active : {{leader.last_update | HumanizeDate}} ago</h2>
        <h2 *ngIf="!leader.last_update" >Last active : {{leader.last_update | HumanizeDate}}</h2>
      </ion-item>
    </ion-card>

    <ion-card *ngFor="let participant of challenge.participants || orderByChild">
      <ion-item *ngIf="!loading">
        <ion-avatar item-left>
          <img src="https://ionicframework.com/dist/preview-app/www/assets/img/avatar-finn.png">
        </ion-avatar>
        <h2>{{participant.fitness_stats.name}} <i *ngIf="participant.complete_date"><ion-icon color="primary" name="checkmark-circle"></ion-icon></i> </h2>
        <p style="white-space: normal"></p>
      </ion-item>
      <ion-item *ngIf="!loading">
        <ion-icon item-left name="trophy"></ion-icon>
        <h2>{{participant.percentage}}%</h2>
        <progress value="{{participant.progress}}" max="{{challenge.completion.required}}"></progress>
      </ion-item>
      <ion-item *ngIf="participant.complete">
        <ion-icon item-left name="stopwatch"></ion-icon>
        <h2>Completed : {{participant.complete_date | HumanizeDate}} ago</h2>
      </ion-item>
      <ion-item *ngIf="!participant.complete">
        <ion-icon item-left name="clock"></ion-icon>
        <h2 *ngIf="participant.last_update" >Last active : {{participant.last_update | HumanizeDate}} ago</h2>
        <h2 *ngIf="!participant.last_update" >Last active : {{participant.last_update | HumanizeDate}}</h2>
      </ion-item>
    </ion-card>

  </ion-list>

</ion-content>